## final

### 1. final 作用

- 修饰变量：常与 static 修饰类成员，作为类常量；修饰基本类型时，值无法更改，修饰引用类型时，引用指向无法修改，但可以调用 setter 等方法对该对象进行修改
- 修饰方法：不能被子类重写，但可以重载；该方法在编译时已经静态绑定，调用时使用 invokespecial，类似 C++ 的 inline，可提升性能；private 方法隐式为 final
- 修饰类：该类无法被继承，并且类中方法默认为 final

常见作用：

(1) 作为常量；(2) <font color=blue>保证线程安全</font>; (3)提高性能

### 2. final 与 jvm

对于 final 域，遵守两个重排序规则：

1. 在 **构造函数** 内对一个 final 域的写入，与之后被构造对象赋值给一个引用变量，这两个操作之间不能重排序。该规则保证 final 域在 **任意线程可见之前都会正确初始化**，实现方式：
   - JMM 禁止编译器将 final 域的写重排序到构造函数之外
   - 在 final 域写之后，构造函数之前，插入 StoreStore 屏障，禁止处理器将其重排序到构造函数之外
2.  **初次** 读包含 final 域的对象的引用，与随后初次读这个 final 域，这两个操作之间不能重排序。该规则保证在**读一个对象的final 域之前，一定会先读该对象的引用**。实现方式：通过在 final 域读操作之前插入 LoadLoad 屏障实现