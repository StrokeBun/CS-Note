[toc]



## CPU

### 1. CPU 执行指令

CPU 执行一个指令需要经过如下步骤：

- 读取指令
- 指令译码
- 执行操作
- 读取操作数
- 写回寄存器

![avatar](img/CPU执行指令.jpg)

### 2. 流水线

#### 2.1 介绍

流水线每一级执行一个 CPU 执行步骤

![avatar](img/流水线模型.jpg)

流水线并不是越深越好，流水线越深，受功耗墙限制越大，也加大了乱序执行、分支预测的难度。



#### 2.2 流水线冒险

**冒险**：下一个时钟周期中下一条指令不能执行

分为以下三种情况：

- **结构冒险**：因缺乏硬件支持而导致指令不能按预期完成，例如无空闲寄存器；通过 cache 可以缓解
- **数据冒险**：一条指令必须等待另一条指令的完成，需要在等待指令后加入**气泡**进行阻塞，在气泡中使用**操作数前推**提升效率
- **控制冒险**：在分支判断时，需要等判断条件执行结束，可以通过**分支预测**改善



### 3. 异常

异常处理机制：

- **状态寄存器**：异常程序计数器 EPC 保存出错地址，通过状态寄存器保存异常原因
- **中断向量**：EPC 保存地址，控制权被转移到中断向量中的地址

在 8086 中，可以设置自己的中断向量和中断处理函数，在进入中断前需保存寄存器数据(PUSH 指令)，通过 INT 产生中断，在中断退出前恢复寄存器数据(POP 指令)